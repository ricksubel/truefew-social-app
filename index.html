<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta tags for responsive design and character encoding -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrueFew - your social circle</title>
    
    <!-- External CSS Dependencies -->
    <!-- Bootstrap CSS (bundle JS at bottom includes Popper) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons for UI components -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Tippy.js for enhanced tooltips (optional) -->
    <link href="https://unpkg.com/tippy.js@6/dist/tippy.css" rel="stylesheet">
    
    <!-- Google Fonts - Montserrat for brand typography -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Custom Stylesheet -->
    <link rel="stylesheet" href="style.css?v=1.1"/>
</head>

<body class="bg-light">
    <!-- Debug: Check if glassmorphism is working -->
    <style>
        .glassmorphism-navbar {
            background: rgba(255, 255, 255, 0.15) !important;
            backdrop-filter: blur(20px) saturate(180%) !important;
            -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
            border: 1px solid rgba(255, 255, 255, 0.125) !important;
        }
    </style>
    <!-- Main Application Container -->
    <!-- ===========================
         NAVIGATION BAR
         =========================== -->
    <!-- Fixed navigation bar with glassmorphism effect -->
    <nav class="navbar navbar-expand-lg navbar-light glassmorphism-navbar fixed-top">
        <div class="container">
            <!-- Brand logo - clickable to return to landing page -->
            <a class="navbar-brand mb-0 h1 fw-bold text-primary" href="#" onclick="showLanding()">TrueFew</a>
            
            <!-- Mobile hamburger menu toggle -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <!-- Collapsible navigation content -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="ms-auto d-flex align-items-center">
                    <!-- Search button - opens user search modal -->
                    <button id="openSearchBtn" class="btn btn-sm btn-outline-info me-2">
                        <i class="bi bi-search"></i> Search Profiles
                    </button>
                    
                    <!-- Profile/Registration button - dual purpose -->
                    <button id="openProfileBtn" class="btn btn-sm btn-outline-secondary me-2">
                        <i class="bi bi-person-plus"></i> Create Profile
                    </button>
                    
                    <!-- Sign in button -->
                    <button id="openSignInBtn" class="btn btn-sm btn-outline-success me-2">
                        <i class="bi bi-box-arrow-in-right"></i> Sign In
                    </button>
                    
                    <!-- User area - shown only when authenticated -->
                    <div id="userNavArea" class="d-flex align-items-center ms-2" style="display: none !important;">
                        <!-- User avatar - clickable to view own profile -->
                        <img id="navUserAvatar" src="" alt="Your Profile" 
                            class="rounded-circle me-2 cursor-pointer" 
                            style="width:35px;height:35px;object-fit:cover;" 
                            onclick="showProfile('current')">
                        
                        <!-- Username display -->
                        <span id="navUsername" class="text-muted me-3"></span>
                        
                        <!-- Sign out button -->
                        <button id="signOutBtn" class="btn btn-sm btn-outline-success">
                            <i class="bi bi-box-arrow-right"></i> Sign Out
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- ===========================
         LANDING PAGE
         =========================== -->
    <!-- Hero section with animated background -->
    <section id="landingPage" class="page-section">
        <div id="hero" class="d-flex align-items-center justify-content-center text-center text-white">
            <!-- Animated hero circle container -->
            <div class="hero-circle-wrapper">
                <div class="hero-circle" role="img" aria-label="TrueFew hero" tabindex="0">
                    <!-- Content overlay with call-to-action -->
                    <div class="hero-overlay">
                        <div class="hero-inner">
                            <!-- Main headline -->
                            <h1 class="hero-title mb-2">TrueFew</h1>
                            
                            <!-- Brand tagline -->
                            <p class="hero-slogan mb-3">small circle. BIG VIBE!</p>
                            
                            <!-- Primary call-to-action button -->
                            <button id="heroCTA" class="btn btn-primary btn-lg mb-3">Get Started</button>
                            
                            <!-- Secondary action buttons -->
                            <div class="mt-3">
                                <!-- Demo button for preview -->
                                <button class="btn btn-outline-accent btn-sm me-2" onclick="showDemo()">View Demo</button>
                                
                                <!-- Sign in shortcut -->
                                <button class="btn btn-outline-accent btn-sm" onclick="document.getElementById('openSignInBtn').click()">Sign In</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Dashboard -->
    <section id="dashboardPage" class="page-section" style="display: none;">
        <div class="container-fluid pt-4">
            <div class="row">
                <!-- Left Sidebar - News Feed -->
                <div class="col-lg-3 col-md-4 mb-4">
                    <div class="card shadow-sm">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0"><i class="bi bi-newspaper"></i> News Feed</h6>
                        </div>
                        <div class="card-body p-0">
                            <div id="newsFeed" class="news-feed-container">
                                <!-- News items will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Center - Post Composer & Feed -->
                <div class="col-lg-6 col-md-8 mb-4">
                    <!-- Post Composer -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-body">
                            <div class="d-flex">
                                <img id="composerAvatar" src="" class="rounded-circle me-3" style="width:40px;height:40px;object-fit:cover;">
                                <div class="flex-grow-1">
                                    <textarea id="postContent" class="form-control mb-3" rows="3" placeholder="What's on your mind?"></textarea>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="btn-group" role="group">
                                            <button id="attachPhotoBtn" class="btn btn-outline-secondary btn-sm" onclick="attachPhoto()">
                                                <i class="bi bi-image"></i> Photo
                                            </button>
                                            <button id="attachVideoBtn" class="btn btn-outline-secondary btn-sm" onclick="attachVideo()">
                                                <i class="bi bi-play-circle"></i> Video
                                            </button>
                                            <button id="attachMusicBtn" class="btn btn-outline-secondary btn-sm" onclick="attachMusic()">
                                                <i class="bi bi-music-note"></i> Music
                                            </button>
                                            <button id="clearAttachmentBtn" class="btn btn-outline-danger btn-sm" onclick="clearAttachment()" style="display: none;">
                                                <i class="bi bi-x-circle"></i> Clear
                                            </button>
                                        </div>
                                        <button id="publishPost" class="btn btn-primary btn-sm">Post</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Posts Feed -->
                    <div id="postsFeed">
                        <!-- Posts will be populated here -->
                    </div>
                </div>

                <!-- Right Sidebar - User Profile & Navigation -->
                <div class="col-lg-3 d-none d-lg-block">
                    <div class="card shadow-sm mb-4">
                        <div class="card-body text-center">
                            <img id="sidebarAvatar" src="" class="rounded-circle mb-3" style="width:80px;height:80px;object-fit:cover;">
                            <h6 id="sidebarUsername" class="fw-bold"></h6>
                            <p class="text-muted small mb-3">Signed in as <span id="sidebarFullName"></span></p>
                            <div class="d-grid gap-2">
                                <button class="btn btn-secondary btn-sm" onclick="showProfile('current')">
                                    <i class="bi bi-person"></i> View Profile
                                </button>
                                <button class="btn btn-outline-secondary btn-sm" onclick="editProfile()">
                                    <i class="bi bi-pencil"></i> Edit Profile
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation Links -->
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <div class="list-group list-group-flush">
                                <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" onclick="showFriends()">
                                    <span><i class="bi bi-people"></i> Friends</span>
                                    <span id="friendsCount" class="badge bg-custom-accent rounded-pill">0</span>
                                </a>
                                <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" onclick="showRequests()">
                                    <span><i class="bi bi-person-plus"></i> Requests</span>
                                    <span id="requestsCount" class="badge bg-custom-accent rounded-pill">0</span>
                                </a>
                                <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" onclick="showMessages()">
                                    <span><i class="bi bi-chat"></i> Messages</span>
                                    <span id="messagesCount" class="badge bg-custom-accent rounded-pill">0</span>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Dynamic Content Area -->
                    <div id="sidebarContent" class="mt-4">
                        <!-- Friends, Requests, Messages content will appear here -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Profile Page -->
    <section id="profilePage" class="page-section" style="display: none;">
        <div class="container pt-4">
            <div class="row">
                <div class="col-md-4">
                    <div class="card shadow-sm">
                        <div class="card-body text-center">
                            <img id="profileAvatar" src="" class="rounded-circle mb-3" style="width:150px;height:150px;object-fit:cover;">
                            <h4 id="profileFullName" class="fw-bold"></h4>
                            <p id="profileUsername" class="text-muted"></p>
                            <p id="profileLocation" class="text-secondary">
                                <i class="bi bi-geo-alt"></i> <span></span>
                            </p>
                            <div id="profileActions" class="d-grid gap-2">
                                <!-- Action buttons will be populated based on viewing own or other's profile -->
                            </div>
                        </div>
                    </div>

                    <!-- Interests -->
                    <div class="card shadow-sm mt-4">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="bi bi-heart"></i> Interests</h6>
                        </div>
                        <div class="card-body">
                            <div id="profileInterests" class="d-flex flex-wrap gap-2">
                                <!-- Interest badges will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-8">
                    <div class="card shadow-sm">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="bi bi-grid"></i> Posts</h6>
                        </div>
                        <div class="card-body">
                            <div id="profilePosts">
                                <!-- User's posts will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Search Results Page -->
    <section id="searchPage" class="page-section" style="display: none;">
        <div class="container pt-4">
            <div class="row">
                <div class="col-12">
                    <div class="card shadow-sm">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="bi bi-search"></i> Search Results</h5>
                        </div>
                        <div class="card-body">
                            <div id="searchResults">
                                <!-- Search results will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- Sign Up Modal -->
    <div class="modal fade" id="signUpModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-person-plus"></i> Create Your Profile</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="signUpForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Full Name *</label>
                                <input type="text" class="form-control" id="signUpFullName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Username *</label>
                                <input type="text" class="form-control" id="signUpUsername" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email *</label>
                                <input type="email" class="form-control" id="signUpEmail" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Password *</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="signUpPassword" required>
                                    <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('signUpPassword', 'signUpPasswordToggle')" id="signUpPasswordToggle">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                </div>
                                <div class="form-text">Min 8 characters with uppercase, lowercase, number</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">City *</label>
                                <input type="text" class="form-control" id="signUpCity" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">State *</label>
                                <input type="text" class="form-control" id="signUpState" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Country *</label>
                                <input type="text" class="form-control" id="signUpCountry" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Profile Image</label>
                            <input type="file" class="form-control" id="signUpImage" accept="image/*">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Select 8 Interests *</label>
                            <div class="row" id="interestsGrid">
                                <!-- Interest checkboxes will be populated here -->\n                            </div>
                            <div class="form-text">Select exactly 8 interests to help us connect you with like-minded people</div>
                            <div id="interestError" class="text-danger" style="display: none;"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="submitSignUp()">Create Profile</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sign In Modal -->
    <div class="modal fade" id="signInModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-box-arrow-in-right"></i> Sign In</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="signInForm">
                        <div class="mb-3">
                            <label class="form-label">Email Address</label>
                            <input type="email" class="form-control" id="signInUsername" required placeholder="Enter your email address">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="signInPassword" required>
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('signInPassword', 'signInPasswordToggle')" id="signInPasswordToggle">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div id="signInError" class="text-danger" style="display: none;"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="submitSignIn()">Sign In</button>
                    <button type="button" class="btn btn-link" onclick="showSignUp()">Need an account?</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Search Modal -->
    <div class="modal fade" id="searchModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-search"></i> Search Profiles</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Search by Name</label>
                        <input type="text" class="form-control" id="searchByName" placeholder="Enter full name or username">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Search by Interests</label>
                        <select class="form-select" id="searchByInterest">
                            <option value="">Select an interest</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="performSearch()">Search</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Photo Upload Modal -->
    <div class="modal fade" id="photoModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-camera"></i> Attach Photo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="file" class="form-control" id="postPhoto" accept="image/*">
                    <div id="photoPreview" class="mt-3" style="display: none;">
                        <img id="previewImage" class="img-fluid" style="max-height: 300px;">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="attachPhotoToPost()">Attach</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Video/Music Modal -->
    <div class="modal fade" id="mediaModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="mediaModalTitle"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label" id="mediaLabel"></label>
                        <input type="url" class="form-control" id="mediaUrl" placeholder="">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="attachMediaToPost()">Attach</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal fade" id="editProfileModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-pencil"></i> Edit Profile</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editProfileForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Full Name *</label>
                                <input type="text" class="form-control" id="editFullName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Username *</label>
                                <input type="text" class="form-control" id="editUsername" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email *</label>
                                <input type="email" class="form-control" id="editEmail" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Profile Picture</label>
                                <input type="file" class="form-control" id="editProfileImage" accept="image/*">
                                <div class="form-text">Leave empty to keep current picture</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">City *</label>
                                <input type="text" class="form-control" id="editCity" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">State *</label>
                                <input type="text" class="form-control" id="editState" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Country *</label>
                                <input type="text" class="form-control" id="editCountry" required>
                            </div>
                        </div>
                        
                        <!-- Password Change Section (Optional) -->
                        <div class="mb-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="changePasswordCheck" onchange="togglePasswordSection()">
                                <label class="form-check-label" for="changePasswordCheck">
                                    <strong>Change Password</strong>
                                </label>
                            </div>
                        </div>
                        
                        <div id="passwordSection" style="display: none;">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Current Password</label>
                                    <div class="input-group">
                                        <input type="password" class="form-control" id="editCurrentPassword">
                                        <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('editCurrentPassword', 'editCurrentPasswordToggle')" id="editCurrentPasswordToggle">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">New Password</label>
                                    <div class="input-group">
                                        <input type="password" class="form-control" id="editNewPassword">
                                        <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('editNewPassword', 'editNewPasswordToggle')" id="editNewPasswordToggle">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                    </div>
                                    <div class="form-text">Min 8 characters with uppercase, lowercase, number</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Interests Section -->
                        <div class="mb-3">
                            <label class="form-label">Interests (Select at least 8) *</label>
                            <div class="row" id="editInterestsGrid">
                                <!-- Interests will be populated here -->
                            </div>
                            <div id="editInterestError" class="text-danger" style="display: none;"></div>
                            <div id="editInterestSuccess" class="text-success" style="display: none;"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="submitEditProfile()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS bundle (includes Popper), then Tippy, then Firebase, then App JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    
    <!-- Firebase SDK (v9 compatibility mode for easier integration) -->
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-analytics-compat.js"></script>
    
    <!-- Firebase Configuration -->
    <script src="firebase-config.js"></script>
    
    <!-- Main Application Script -->
    <script src="script.js?v=1.1"></script>
    
    <!-- Debug Script -->
    <script>
        console.log('🐛 Debug: Page loaded');
        
        // Debug the profile button issue
        document.addEventListener('DOMContentLoaded', function() {
            const profileBtn = document.getElementById('openProfileBtn');
            if (profileBtn) {
                console.log('🐛 Profile button found:', profileBtn);
                
                // Remove all existing listeners and add a clean one
                const newBtn = profileBtn.cloneNode(true);
                profileBtn.parentNode.replaceChild(newBtn, profileBtn);
                
                newBtn.addEventListener('click', function() {
                    console.log('🐛 Profile button clicked!');
                    if (window.isSignedInMode) {
                        console.log('🐛 Calling editProfile()');
                        editProfile();
                    } else {
                        console.log('🐛 Calling showSignUpModal()');
                        showSignUpModal();
                    }
                });
                
                console.log('🐛 Clean profile button listener added');
            }
        });
    </script>
</body>
</html>